---
title: 一日一练-网络 了解CSRF
date: 2018-05-29 09:01:12
tags:
---

> 子曰：了解CSRF

## 0x00 简介
通过XHR 访问的URL 可以通过浏览器或服务器来访问。下面的URL 就是一个例子。
```
/getuserinfo.php?id=23
```
如果向这个URL 发送请求，可以想象结果会返回ID 为23 的用户的某些数据。别人可以将这个URL 的用户ID 修改我24、25。因此`getuserinfo.php` 文件必须知道请求者是否真的有权限访问要请求的数据；否则，你的服务器上的任何人的数据都可能被泄漏出去。

对于未被授权系统有权访问某个资源的情况，我们称之为CSRF（Cross-Site Request Forgery, 跨站点请求伪造）。未被授权系统会伪装自己，让处理请求的服务器认为它是合法的。

## 0x01 预防
为了确保通过XHR 访问的URL  安全，通行的做法就是验证发送请求者是否有权限访问相应的资源。有下列几种方式可供选择。
1. 要求以SSL 连接来访问可以通过XHR 请求的资源
2. 要求每一次请求都要附带经过相应算法计算得到的验证码。
请注意，下列措施对防范CSRF 攻击不起作用。
1. 要求发送POST 请求而不是GET 请求 -- 很容易改变。
2. 检查来源URL 以确定是否可信 -- 来源记录很容易伪造。
3. 基于cookie 信息进行验证 -- 同样很容易伪造。

## 0x02 区别
CSRF（跨站请求伪造）会借用目标用户的权限去做一些借刀杀人的事（注意是“借用”，而不是“盗用” 目标权限），然后去做坏事，“盗取”通常是XSS（跨站脚本攻击）最喜欢做的事。
