---
title: 一日一练-网络 了解代理、网关和隧道
date: 2018-05-30 19:09:27
tags:
  - 技术
  - 一日一练
  - 网络
categories: 技术
---

>子曰：了解网络中的代理、网关和隧道

HTTP 通信时，除客户端和服务器以外，还有一些用于通信数据转发的应用程序，例如代理、网关和隧道。它们可以配合服务器工作。

这些应用程序和服务器可以将请求转发给通信线路上的下一站服务器，并且能接收从那台服务器发送的响应在转发给客户端。

<!--more-->

**代理**
代理是一种有转发功能的应用程序，它扮演了位于服务器和客户端“中间人” 的角色，接收由客户端发送的请求并转发给服务器，同时也接收服务器返回的响应并转发给客户端。

**网关**
网关是转发其他服务器通信数据的服务器，接收从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理。有时客户端可能都不会察觉，自己的通信目标是一个网关。

**隧道**
隧道是在相隔甚远的客户端和服务器两者之间进行中转，并保持双方通信连接的应用程序。

## 代理
{% asset_img agent_0.jpg %}
代理服务器的基本行为就是接收由客户端发送的请求并转发给其他服务器。代理不改变请求URI，会直接发送给前方持有资源的目标服务器。

持有资源服务器的实体称为源服务器。从源服务器返回的响应经过代理服务器后再传给客户端。
{% asset_img agent_1.jpg %}

在HTTP 通信中，可级联多台代理服务器。请求和响应的转发会经过数台类似锁链一样连接起来的代理服务器。转发时，需要附加Via 首部字段以标记出经过的主机信息。

利用代理服务器的理由有：利用缓存技术减少网络带宽的流量，组织内部针对特定网站的访问控制，以获取访问日志为主要目的等等。

代理有多种使用方法，按两种基准分类。一种是是否使用缓存，另一种是是否会修改报文。
1. 缓存代理（Caching Proxy）
  代理转发响应时，缓存代理会预先将资源的副本（缓存）保存在代理服务器上。
  当代理再次接收到对相同资源的请求时，就可以不从原服务器那里获取资源，而是将之前缓存的资源作为响应返回。
2. 透明代理（Transparent Proxy）
  转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理。反之，对报文内容进行加工的代理称为非透明代理。

## 网关
{% asset_img agent_2.jpg %}

网关的工作机制和代理十分相似。而网关能使通信线路上的服务器提供非HTTP 协议服务。

利用网关能够提高通信的安全性，因为可以在客户端与网关之间的通信线路上加密以确保连接的安全。比如，网关可以连接数据库，使用SQL 语句查询数据。另外，在Web 购物网站上进行信用卡结算时，网关可以和信用卡结算系统联动。

## 隧道

隧道可按要求建立起一条与其他服务器的通信线路，届时使用SSL 等加密手段进行通信。隧道的目的是确保客户端能与服务器进行安全的通信。

隧道本身不会去解析HTTP 请求。也就是说，请求保持原样中转给之后的服务器。隧道会在通信双方断开连接时结束。
{% asset_img agent_3.jpg %}

## 参考文档
1. 《图解HTTP》 第5 章 与http 协作的web 服务器 5.2 通信数据转发程序：代理、网关、隧道
